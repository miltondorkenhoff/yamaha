<html>
 <head>
  <link rel="stylesheet" type="text/css" href="css/simple.css"></link>
  <title>Our Yamaha Configuration Page</title>
  <script src="js/jquery-3.3.1.min.js"></script>
  <script>
    // CGI request to set/change something
    // http://192.168.1.215/cgi-bin/tttt.py?zone=Zone_2&source=TUNER&state=Standby

    //-------------------------------------------------------------------------
    // Go through all of the options associated with the <select> named name
    // and select the one labeled 'source'
    //-------------------------------------------------------------------------
    function selectSource( name, source ){
      var el = document.getElementById( name );
      for(i = 0; i < el.options.length; i++ ){
        if( el.options[i].value == source ){
          el[i].selected = "selected";
        } else  {
          el[i].selected = "";
        }
      }
    }

    //-------------------------------------------------------------------------
    // Enable/disable the on/off buttons
    //-------------------------------------------------------------------------
    function selectState( name, state ){
      var on_button = document.getElementById( name + "_on" );
      var off_button = document.getElementById( name + "_off" );

      if( state == "On" ){
        on_button.disabled = true;
        off_button.disabled = false;
      } else {
        on_button.disabled = false;
        off_button.disabled = true;
      }
    }

    //-------------------------------------------------------------------------
    // Get the on/off state and currently select source for the given zone
    //-------------------------------------------------------------------------
    function getInfo( zone, id_prefix ){
      $.ajax( {
        url: "/cgi-bin/yamaha.py",
        type: "GET",
        data: {
          action: "get",
          receiver: "192.168.1.218",
          zone: zone
        },

        success: function( data ){
          console.log( "success: " + data );
          var msg = "Zone: " + data.zone + "(" + id_prefix + ") is set to " + data.source + " and is " + data.power;
          console.log( msg );

          // Update the UI to match the source/power state
          selectSource( id_prefix, data.source );
          selectState( id_prefix, data.power );
        },

        complete: function() {
          console.log( "complete." );
        },

        error: function() {
          alert( "Some sort of failure." );
        }

      } );
    }

    //-------------------------------------------------------------------------
    // Set the source for a zone and turn it on or off
    //-------------------------------------------------------------------------
    function onOrOff( id, zone, state ){

      var selector = document.getElementById( id );
      var source = selector.options[ selector.selectedIndex ].value
      console.log( "Changing " + zone + " to " + source + ", and " + state );

      $.ajax( {
        url: "/cgi-bin/yamaha.py",
        type: "GET",
        data: {
          action: "set",
          receiver: "192.168.1.218",
          zone: zone,
          source: source,
          state: state
        },

        success: function( data ){
          console.log( "success: " + data );
          getInfo( zone, id );
        },

        complete: function() {
          console.log( "complete." );
        },

        error: function() {
          alert( "Some sort of failure." );
        }

      } );
    }

    //-------------------------------------------------------------------------
    //
    //-------------------------------------------------------------------------
    function test( on_or_off ){
      alert( "testing!" );
      $.ajax( {
        url: "/cgi-bin/tttt.py",
        type: "GET",
        data: {
          receiver: "192.168.1.218",
          zone: "Zone_3",
          source: "TUNER",
          state: on_or_off
        },
        success: function( data ){
          alert( "success: " + data );
        },
        complete: function() {
          alert( "complete." );
        },
        error: function() {
          alert( "Some sort of failure." );
        }
      } );
    }

    //-------------------------------------------------------------------------
    //
    //-------------------------------------------------------------------------
    $( document ).ready(function() {
      console.log( "ready!" );
      getInfo( 'Main_Zone', 'livingRoom' );
      getInfo( 'Zone_2', 'office' );
      getInfo( 'Zone_3', 'kitchen' );
      // getInfo( 'Zone_4' );
    });

  </script>
 <head>
 <body>
  <!--
  <p>This is some text</p>
  <input type="button" onclick="test( 'On' );" value="Turn on radio"></input>
  <input type="button" onclick="test( 'Standby' );" value="Turn off radio"></input>
  -->
  <table>
   <thead>
    <tr>
     <td>Room</td>
     <td>Source</td>
     <!-- <td>Volume</td> -->
     <td>On/Off</td>
    </td>
   </thead>

   <!-- Living Room -->
   <tr>
    <td class="roomName">Living Room</td>
    <td>
     <select class="sourceList" id="livingRoom">
      <option value="AV1" selected="selected">Television</option>
      <option value="TUNER">Radio</option>
      <option value="Pandora">Pandora</option>
      <option value="AV3">Chromecast</option>
      <option value="PHONO">Record Player</option>
      <option value="AV2">DVD</option>
      <option value="AUDIO1">CD</option>
     </select>
    </td>
    <!-- <td>Volume</td> -->
    <td>
     <input id="livingRoom_on" class="onButton" type="button" onclick="onOrOff( 'livingRoom', 'Main_Zone', 'On' );" value="On"></input>
     <input id="livingRoom_off" class="offButton" type="button" onclick="onOrOff( 'livingRoom', 'Main_Zone', 'Standby' );" value="Off"></input>
    </td>
   </tr>

   <!-- Kitchen -->
   <tr>
    <td class="roomName">Kitchen</td>
    <td>
     <select class="sourceList" id="kitchen">
      <option value="AV1">Television</option>
      <option value="TUNER" selected="selected">Radio</option>
      <option value="Pandora">Pandora</option>
      <option value="AV3">Chromecast</option>
      <option value="PHONO">Record Player</option>
      <option value="AV2">DVD</option>
      <option value="AUDIO1">CD</option>
     </select>
    </td>
    <!-- <td>Volume</td> -->
    <td>
     <input id="kitchen_on" class="onButton" type="button" onclick="onOrOff( 'kitchen', 'Zone_3', 'On' );" value="On"></input>
     <input id="kitchen_off" class="offButton" type="button" onclick="onOrOff( 'kitchen', 'Zone_3', 'Standby' );" value="Off"></input>
    </td>
   </tr>

   <!-- Office -->
   <tr>
    <td class="roomName">Office</td>
    <td>
     <select class="sourceList" id="office">
      <option value="AV1">Television</option>
      <option value="TUNER" selected="selected">Radio</option>
      <option value="Pandora">Pandora</option>
      <option value="AV3">Chromecast</option>
      <option value="PHONO">Record Player</option>
      <option value="AV2">DVD</option>
      <option value="AUDIO1">CD</option>
     </select>
    </td>
    <!-- <td>Volume</td> -->
    <td>
     <input id="office_on" class="onButton" type="button" onclick="onOrOff( 'office', 'Zone_2', 'On' );" value="On"></input>
     <input id="office_off" class="offButton" type="button" onclick="onOrOff( 'office', 'Zone_2', 'Standby' );" value="Off"></input>
    </td>
   </tr>
  </table>
 </body>
</html>
